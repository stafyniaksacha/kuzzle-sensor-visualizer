// This is the Kuzzle SDK version 0.2.0 - Licenced under the Apache 2.0 Licence
!function(a,b){"function"==typeof define&&define.amd?define(["socket.io"],b):"object"==typeof module&&module.exports?module.exports=b(require("socket.io-client")):("undefined"==typeof io&&(console.log("Socketio dependency for Kuzzle not found. "),console.log('maybe you have to had something like : <script src="path/to/socket.io-1.3.4.js"></script>   ?')),a.Kuzzle=b(io))}(this,function(a){"undefined"==typeof a&&("function"==typeof define&&define.amd?console.log("io dependency not found, maybe something wrong with you require path configuration ?"):"object"==typeof module&&module.exports&&console.log("something wrong with socketio dependency "));var b=function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");return function(b,c){var d,e=a,f=[];if(c=c||e.length,b)for(d=0;b>d;d++)f[d]=e[0|Math.random()*c];else{var g;for(f[8]=f[13]=f[18]=f[23]="-",f[14]="4",d=0;36>d;d++)f[d]||(g=0|16*Math.random(),f[d]=e[19==d?3&g|8:g])}return f.join("")}}(),c={socket:null,subscribedRooms:[],bucket:{},init:function(b){return this.socket?this:b&&""!==b?(this.socket=a(b),this):(console.error("Url to Kuzzle can't be empty"),!1)},subscribe:function(a,c,d){var e=b();return this.socket.once(e,function(a){this.subscribedRooms[e]=a.result.roomId,this.socket.off(a.result.roomId),this.socket.on(a.result.roomId,function(a){d(a.error,a.result)})}.bind(this)),this.socket.emit("subscribe",{requestId:e,action:"on",collection:a,body:c}),e},unsubscribe:function(a){return this.subscribedRooms[a]?(this.socket.emit("subscribe",{requestId:a,action:"off"}),this.socket.off(this.subscribedRooms[a]),void delete this.subscribedRooms[a]):!1},countSubscription:function(a,c){var d=b();c&&this.socket.once(d,function(a){c(a.error,a.result)}),this.socket.emit("subscribe",{requestId:d,action:"count",body:{roomId:this.subscribedRooms[a]}})},write:function(a,c,d,e,f){var g=b();f&&this.socket.once(g,function(a){f(a.error,a.result)}),void 0===e&&(e=!1),this.socket.emit("write",{requestId:g,action:c,persist:e,collection:a,body:d})},bulk:function(a,c,d){var e=b();d&&this.socket.once(e,function(a){d(a.error,a.result)}),this.socket.emit("bulk",{requestId:e,action:"import",persist:!0,collection:a,body:c})},admin:function(a,c,d,e){var f=b();e&&this.socket.once(f,function(a){e(a.error,a.result)}),this.socket.emit("admin",{requestId:f,action:c,collection:a,body:d})},putMapping:function(a,b,c){this.admin(a,"putMapping",b,c)},create:function(a,b,c,d){this.write(a,"create",b,c,d)},update:function(a,b,c){this.write(a,"update",b,!0,c)},"delete":function(a,b,c){var d={_id:b};this.write(a,"delete",d,!0,c)},deleteByQuery:function(a,b,c){this.write(a,"deleteByQuery",b,!0,c)},search:function(a,b,c){this.readWithQuery(a,b,"search",c)},get:function(a,c,d){var e=b();this.socket.once(e,function(a){d(a.error,a.result)}),this.socket.emit("read",{requestId:e,action:"get",collection:a,_id:c})},count:function(a,c,d){var e=b();this.socket.once(e,function(a){d(a.error,a.result)}),this.socket.emit("read",{requestId:e,action:"count",collection:a,body:c})},readWithQuery:function(a,c,d,e){var f=b();this.socket.once(f,function(a){e(a.error,a.result)});var g={requestId:f,action:d,collection:a};if(Object.keys(c).length>1){var h;for(h in c)c.hasOwnProperty(h)&&(g[h]=c[h])}else g.body=c;this.socket.emit("read",g)},prepare:function(a,b,c){var d;switch(b){case"write":case"insert":case"create":d=[{create:{}}],d.push(c);break;case"update":d=[{update:{_retry_on_conflict:3}}],d.push(c);break;case"delete":d=[{"delete":{_id:c}}]}this.bucket[a]?this.bucket[a]=this.bucket[a].concat(d):this.bucket[a]=d},commit:function(a,b){if(this.bucket[a]){var c=JSON.parse(JSON.stringify(this.bucket[a]));delete this.bucket[a],this.bulk(a,c,function(a){a.bulkBody=c,b&&b(a.error,a.result)})}else{var d={error:null,response:{status:'no prepared query for "'+a+'" collection'}};b&&b(d.error,d.result)}},close:function(){this.socket.close()}};return c});
//# sourceMappingURL=kuzzle.min.map